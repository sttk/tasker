'use strict'

const Lineno = require('tasker/src/lineno.js')
const assert = require('assert')
const load = require('load')

describe('Test of Lineno', () => {
  describe('#get', () => {
    it('do in this file.', () => {
      let lineno = new Lineno(__filename)
      let lno = lineno.get()
      assert.equal(lno, 11)
    })

    it('do in eval-ed code.', () => {
      /* eslint no-eval:0 */
      let src = '\n' +
        'let lineno = new Lineno(__filename)\n' +
        'let lno = lineno.get()\n' +
        'assert.equal(lno, 3)\n' +
        ''
      eval(src)
    })

    it('do in require-ed file.', () => {
      let ret = require('tasker/tests/lineno/a.js')
      let lno = ret.lineno
      assert.equal(lno, 6)
    })

    it('do in load-ed file.', () => {
      let filename = require.resolve('tasker/tests/lineno/a.js')
      let ctx = load(filename, {module: {}, exports: {}})
      let lno = ctx.module.exports.lineno
      assert.equal(lno, 6)
    })
  })
})
